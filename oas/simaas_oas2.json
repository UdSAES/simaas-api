{
    "swagger": "2.0",
    "info": {
        "title": "SIMaaS Using Queue, Workers and fmpy",
        "version": "0.3.0"
    },
    "paths": {
        "/model-instances": {
            "get": {
                "tags": ["Model Instances"],
                "summary": "A list of all available model instances",
                "produces": [ "application/problem+json" ],
                "responses": {
                    "501": {"$ref": "#/responses/NotImplemented"}
                }
            },
            "post": {
                "tags": ["Model Instances"],
                "summary": "Instantiate a model for a specific system",
                "consumes": ["application/json"],
                "produces": [ "application/problem+json" ],
                "parameters": [
                    {"$ref": "#/parameters/ModelInstance"}
                ],
                "responses": {
                    "501": {"$ref": "#/responses/NotImplemented"},
                    "400": { "$ref": "#/responses/SchemaValidationFailed" }
                }
            }
        },
        "/model-instances/{uuid}": {
            "get": {
                "tags": ["Model Instances"],
                "summary": "A specific model instance",
                "produces": [ "application/problem+json" ],
                "responses": {
                    "501": {"$ref": "#/responses/NotImplemented"},
                    "400": { "$ref": "#/responses/SchemaValidationFailed" }
                }
            },
            "delete": {
                "tags": ["Model Instances"],
                "summary": "Delete a specific model instance",
                "produces": [ "application/problem+json" ],
                "responses": {
                    "501": {"$ref": "#/responses/NotImplemented"},
                    "400": { "$ref": "#/responses/SchemaValidationFailed" }
                }
            },
            "parameters": [
                {"$ref": "#/parameters/ModelInstanceID"}
            ]
        },
        "/experiments": {
            "get": {
                "tags": ["Experiments"],
                "summary": "A list of all available experiments",
                "produces": [ "application/problem+json" ],
                "responses": {
                    "501": {"$ref": "#/responses/NotImplemented"}
                }
            },
            "post": {
                "tags": ["Experiments"],
                "summary": "Trigger the simulation of a model instance by defining an experiment",
                "consumes": [ "application/json" ],
                "produces": [ "application/json", "application/problem+json" ],
                "parameters": [
                    {
                        "$ref": "#/parameters/ExperimentSetup"
                    }
                ],
                "responses": {
                    "202": {
                        "description": "An acknowledgement that the simulation was successfully triggered",
                        "headers": {
                            "Location": {
                                "description": "Referral to a resource that indicates the status of the long-running simulation; this resource needs to be polled ([RFC7231, section 7.1.2](https://tools.ietf.org/html/rfc7231#section-7.1.2))",
                                "type": "string"
                            }
                        }
                    },
                    "400": { "$ref": "#/responses/SchemaValidationFailed" }
                }
            }
        },
        "/experiments/{uuid}": {
            "get": {
                "tags": ["Experiments"],
                "summary": "A specific experiment",
                "produces": [ "application/problem+json" ],
                "responses": {
                    "501": {"$ref": "#/responses/NotImplemented"},
                    "400": { "$ref": "#/responses/SchemaValidationFailed" }
                }
            },
            "parameters": [
                { "$ref": "#/parameters/ExperimentID" }
            ]
        },
        "/experiments/{uuid}/status": {
            "get": {
                "tags": ["Experiments"],
                "summary": "A resource indicating the status of an experiment",
                "produces": [ "application/json", "application/problem+json" ],
                "responses": {
                    "200": { "$ref": "#/responses/ExperimentStatus" },
                    "400": { "$ref": "#/responses/SchemaValidationFailed" }
                }
            },
            "parameters": [
                { "$ref": "#/parameters/ExperimentID" }
            ]
        },
        "/experiments/{uuid}/result": {
            "get": {
                "tags": ["Experiments"],
                "summary": "The results of performing the experiment/simulation",
                "consumes": [ "application/json" ],
                "produces": [ "application/json", "application/problem+json" ],
                "responses": {
                    "200": { "$ref": "#/responses/SimulationResult" },
                    "400": { "$ref": "#/responses/SchemaValidationFailed" }
                }
            },
            "parameters": [
                { "$ref": "#/parameters/ExperimentID" }
            ]
        },
        "/notfound": {
            "get": {
                "tags": ["Unsuccessful Operations"],
                "summary": "A resource that does not exist",
                "produces": [ "application/problem+json" ],
                "deprecated": true,
                "responses": {
                    "404": { "$ref": "#/responses/NotFound" }
                }
            }
        }
    },
    "definitions": {
        "ErrorInstance": {
            "type": "object",
            "required": [ "error" ],
            "properties": {
                "error": {
                    "type": "object",
                    "description": "A serialization of an instance of the [Node.js-class](https://nodejs.org/dist/latest-v10.x/docs/api/errors.html#errors_errors) `Error`",
                    "required": [
                        "code",
                        "message",
                        "stack"
                    ],
                    "properties": {
                        "code": {
                            "type": "string",
                            "description": "A string label for identifying the kind of error"
                        },
                        "message": {
                            "type": "string",
                            "description": "A description of the specific error instance"
                        },
                        "stack": {
                            "type": "string",
                            "description": "The stack trace describing the point in the code at which the error occured"
                        }
                    }
                }
            }
        },
        "ProblemDetail": { "$ref": "https://raw.githubusercontent.com/UdSAES/designetz_schemata/dev/schemata/problem-detail/schema_v0.1.0_oas2.json#/ProblemDetail" },
        "ModelInstanceID": {
            "description": "The UUID of the model instance to be simulated",
            "type": "string",
            "pattern": "^[0-9A-Za-z]{8}-[0-9A-Za-z]{4}-4[0-9A-Za-z]{3}-[89ABab][0-9A-Za-z]{3}-[0-9A-Za-z]{12}$",
            "enum": [ "c02f1f12-966d-4eab-9f21-dcf265ceac71" ]
        },
        "ModelInstance": {
            "type": "object",
            "required": [
                "model",
                "parameters"
            ],
            "properties": {
                "model": {
                    "type": "string",
                    "format": "uri"
                },
                "parameters": {
                    "allOf": [
                        { "description": "The parameter set that defines the model instance" },
                        { "$ref": "https://raw.githubusercontent.com/UdSAES/designetz_schemata/dev/schemata/location/schema_v0.1.0_oas2.json#/Location" },
                        { "$ref": "./oas/schema_pv_plant_oas2.json#/PVplant" },
                        { "description": "The parameter set that defines the model instance" }
                    ]
                }
            },
            "example": {
                "model": "http://example.com/models/d8b032d4-44a0-4bc5-9ded-c73703f3e5fc",
                "parameters": {
                    "latitude": {
                        "unit": "deg",
                        "value": 49.2553
                    },
                    "longitude": {
                        "unit": "deg",
                        "value": 7.0405
                    },
                    "elevation": {
                        "unit": "m",
                        "value": 273
                    },
                    "panelArea": {
                        "unit": "m2",
                        "value": 2
                    },
                    "panelTilt": {
                        "unit": "deg",
                        "value": 30
                    },
                    "panelAzimuth": {
                        "unit": "deg",
                        "value": 0
                    },
                    "T_cell_ref": {
                        "unit": "K",
                        "value": 298.15
                    }
                }
            }
        },
        "SimulationParameters": {
            "type": "object",
            "required": [
                "startTime",
                "stopTime"
            ],
            "properties": {
                "startTime": {
                    "description": "The beginning of the desired time frame for the simulation in [milliseconds since the UNIX epoch](https://en.wikipedia.org/wiki/Unix_time)",
                    "type": "integer",
                    "format": "int64",
                    "minimum": 0,
                    "example": 1526637990000
                },
                "stopTime": {
                    "description": "The end of the desired time frame for the simulation in [milliseconds since the UNIX epoch](https://en.wikipedia.org/wiki/Unix_time)",
                    "type": "integer",
                    "format": "int64",
                    "minimum": 0,
                    "example": 1526551590000
                },
                "outputInterval": {
                    "description": "The desired output interval in seconds (does _not_ affect step size of the integration algorithm)",
                    "type": "integer",
                    "format": "int64",
                    "minimum": 0,
                    "example": 900
                }
            }
        },
        "InputTimeseries": {
            "type":"array",
            "items": [
                {
                    "allOf": [
                        { "$ref":"https://raw.githubusercontent.com/UdSAES/designetz_schemata/dev/schemata/timeseries/schema_v1.3.0-oas2.json#/Timeseries" },
                        { "required": [ "label" ] },
                        { "properties": { "label": { "pattern": "^temperature$" } } }
                    ]
                },
                {
                    "allOf":[
                        { "$ref":"https://raw.githubusercontent.com/UdSAES/designetz_schemata/dev/schemata/timeseries/schema_v1.3.0-oas2.json#/Timeseries" },
                        { "required": [ "label" ] },
                        { "properties": { "label": { "pattern": "^directHorizontalIrradiance$" } } }
                    ]
                },
                {
                    "allOf":[
                        { "$ref":"https://raw.githubusercontent.com/UdSAES/designetz_schemata/dev/schemata/timeseries/schema_v1.3.0-oas2.json#/Timeseries" },
                        { "required": [ "label" ] },
                        { "properties": { "label": { "pattern": "^diffuseHorizontalIrradiance$" } } }
                    ]
                }
            ],
            "minItems":3,
            "maxItems":3
        }
    },
    "parameters": {
        "ModelInstanceID": {
            "name": "uuid",
            "in": "path",
            "description": "The UUID of the model instance to be simulated",
            "required": true,
            "type": "string",
            "pattern": "^[0-9A-Za-z]{8}-[0-9A-Za-z]{4}-4[0-9A-Za-z]{3}-[89ABab][0-9A-Za-z]{3}-[0-9A-Za-z]{12}$",
            "x-example": "c02f1f12-966d-4eab-9f21-dcf265ceac71"
        },
        "ModelInstance": {
            "name": "modelInstance",
            "in": "body",
            "description": "A representation of a model instance, used for instantiating a model",
            "required": true,
            "schema": {
                "$ref": "#/definitions/ModelInstance"
            }
        },
        "ExperimentSetup": {
            "name": "experimentSetup",
            "in": "body",
            "description": "The boundary conditions and simulation parameters that define an experiment",
            "required": true,
            "schema": {
                "type": "object",
                "required": [
                    "modelInstanceID",
                    "simulationParameters"
                ],
                "properties": {
                    "modelInstanceID": {
                        "$ref": "#/definitions/ModelInstanceID"
                    },
                    "simulationParameters": {
                        "$ref": "#/definitions/SimulationParameters"
                    },
                    "inputTimeseries": {
                        "$ref": "#/definitions/InputTimeseries"
                    }
                },
                "example": {"modelInstanceID":"c02f1f12-966d-4eab-9f21-dcf265ceac71","simulationParameters":{"startTime":1542326400000,"stopTime":1542412800000,"outputInterval":3600},"inputTimeseries":[{"label":"temperature","unit":"K","timeseries":[{"timestamp":0,"value":278.19512939453125},{"timestamp":3600,"value":278.215576171875},{"timestamp":7200,"value":278.0497741699219},{"timestamp":10800,"value":278.00384521484375},{"timestamp":14400,"value":278.2565612792969},{"timestamp":18000,"value":278.49554443359375},{"timestamp":21600,"value":278.43145751953125},{"timestamp":25200,"value":278.3800964355469},{"timestamp":28800,"value":278.0195617675781},{"timestamp":32400,"value":277.91796875},{"timestamp":36000,"value":278.8022766113281},{"timestamp":39600,"value":279.6802062988281},{"timestamp":43200,"value":280.3817138671875},{"timestamp":46800,"value":280.2247009277344},{"timestamp":50400,"value":280.041015625},{"timestamp":54000,"value":278.9366149902344},{"timestamp":57600,"value":277.5219421386719},{"timestamp":61200,"value":276.64959716796875},{"timestamp":64800,"value":275.8999938964844},{"timestamp":68400,"value":275.3359069824219},{"timestamp":72000,"value":275.12396240234375},{"timestamp":75600,"value":274.9482421875},{"timestamp":79200,"value":274.85357666015625},{"timestamp":82800,"value":274.45611572265625},{"timestamp":86400,"value":274.0621337890625}]},{"label":"directHorizontalIrradiance","unit":"W/m²","timeseries":[{"timestamp":0,"value":0},{"timestamp":3600,"value":0},{"timestamp":7200,"value":0},{"timestamp":10800,"value":0},{"timestamp":14400,"value":0},{"timestamp":18000,"value":0},{"timestamp":21600,"value":0},{"timestamp":25200,"value":0},{"timestamp":28800,"value":0},{"timestamp":32400,"value":0.26611328125},{"timestamp":36000,"value":3.4267578125},{"timestamp":39600,"value":120.26953125025734},{"timestamp":43200,"value":189.79492195235423},{"timestamp":46800,"value":131.05468808034462},{"timestamp":50400,"value":92.70703140548973},{"timestamp":54000,"value":22.308593750018108},{"timestamp":57600,"value":-0.04687499998499536},{"timestamp":61200,"value":0.005859375012417635},{"timestamp":64800,"value":0.015625000011382832},{"timestamp":68400,"value":0.09765625001034803},{"timestamp":72000,"value":-0.031249999990686773},{"timestamp":75600,"value":-0.021484374991204175},{"timestamp":79200,"value":-0.11328124999223897},{"timestamp":82800,"value":-0.03710937499223898},{"timestamp":86400,"value":-0.014648437493273781}]},{"label":"diffuseHorizontalIrradiance","unit":"W/m²","timeseries":[{"timestamp":0,"value":0},{"timestamp":3600,"value":0},{"timestamp":7200,"value":0},{"timestamp":10800,"value":0},{"timestamp":14400,"value":0},{"timestamp":18000,"value":0},{"timestamp":21600,"value":0},{"timestamp":25200,"value":1.3330078125},{"timestamp":28800,"value":32.233642578125},{"timestamp":32400,"value":88.14252650737762},{"timestamp":36000,"value":135.14795458316803},{"timestamp":39600,"value":146.50878405570984},{"timestamp":43200,"value":105.37438011169434},{"timestamp":46800,"value":109.1113030910492},{"timestamp":50400,"value":76.60409712791443},{"timestamp":54000,"value":45.17407441139221},{"timestamp":57600,"value":-0.022092819213867188},{"timestamp":61200,"value":-0.05955910682678223},{"timestamp":64800,"value":0.0907127857208252},{"timestamp":68400,"value":-0.024605274200439453},{"timestamp":72000,"value":0.018280982971191406},{"timestamp":75600,"value":-0.04622960090637207},{"timestamp":79200,"value":0.010348081588745117},{"timestamp":82800,"value":0.11771965026855469},{"timestamp":86400,"value":0.028800249099731445}]}]}
            }
        },
        "ExperimentID": {
            "name": "uuid",
            "in": "path",
            "description": "A unique identifier for a specific experiment",
            "required": true,
            "type": "string",
            "pattern": "^[0-9A-Za-z]{8}-[0-9A-Za-z]{4}-4[0-9A-Za-z]{3}-[89ABab][0-9A-Za-z]{3}-[0-9A-Za-z]{12}$",
            "x-example": "d9a23e72-b01a-4be7-a598-c3f31071da2c"
        }
    },
    "responses": {
        "NotFound": {
            "description": "The requested resource was not found on this server",
            "schema": {
                "allOf": [
                    { "$ref": "#/definitions/ProblemDetail" },
                    { "required": [ "title", "status" ]}
                ]
            },
            "headers": {
                "Content-Type": { "type": "string", "enum": ["application/problem+json"] }
            },
            "examples": {
                "application/problem+json": {
                    "title": "Not Found",
                    "status": 404,
                    "detail": "The requested resource was not found on this server"
                }
            }
        },
        "SchemaValidationFailed": {
            "description": "The response for requests that were dropped because they were syntactically invalid and failed schema validation",
            "schema": {
                "allOf": [
                    { "$ref": "#/definitions/ProblemDetail" },
                    { "required": [ "title", "status" ]}
                ]
            },
            "headers": {
                "Content-Type": { "type": "string", "enum": ["application/problem+json"] }
            },
            "examples": {
                "application/problem+json": {"title": "Schema Validation Failed", "status": 400, "detail":"Request validation failed: Parameter (uuid) does not match required pattern: ^[0-9A-Za-z]{8}-[0-9A-Za-z]{4}-4[0-9A-Za-z]{3}-[89ABab][0-9A-Za-z]{3}-[0-9A-Za-z]{12}$",  "path":["paths","/model-instances/{uuid}","parameters","0"]}
                }
        },
        "NotImplemented": {
            "description": "The API's response to requests that cannot be answered yet",
            "schema": {
                "allOf": [
                    { "$ref": "#/definitions/ProblemDetail" },
                    { "required": [ "title", "status" ]}
                ]
            },
            "headers": {
                "Content-Type": { "type": "string", "enum": ["application/problem+json"] }
            },
            "examples": {
                "application/problem+json": {
                    "title": "Not Implemented",
                    "status": 501,
                    "detail": "The request was understood, but the underlying implementation is not available yet."
                }
            }
        },
        "ExperimentStatus": {
            "description": "The current status of the experiment",
            "schema": {
                "type": "object",
                "required": [
                    "status"
                ],
                "properties": {
                    "status": {
                        "type": "string",
                        "enum": [ "NEW", "IN_PROGRESS", "DONE" ],
                        "description": "The status of the background job, for example 'IN_PROGRESS'"
                    },
                    "linkToResult": {
                        "type": "string",
                        "format": "uri",
                        "description": "The link to the initially requested resource (the simulation result) that is now available. This property only exists if the status has reached 'DONE' and the result is indeed available."
                    }
                }
            },
            "headers": {
                "Content-Type": { "type": "string", "enum": ["application/json"] }
            },
            "examples": {
                "application/json": { "status": "DONE", "linkToResult": "http://example.com/experiments/d9a23e72-b01a-4be7-a598-c3f31071da2c/result"}
            }
        },
        "SimulationResult": {
            "description": "The simulation result",
            "schema": {
                "type": "object",
                "required": [
                    "description",
                    "result"
                ],
                "properties": {
                    "description": {
                        "type": "string"
                    },
                    "result": {
                        "type": "array",
                        "items": {
                            "$ref": "https://raw.githubusercontent.com/UdSAES/designetz_schemata/dev/schemata/timeseries/schema_v1.3.0-oas2.json#/Timeseries"
                        }
                    }
                }
            },
            "headers": {
                "Content-Type": { "type": "string", "enum": ["application/json"] }
            },
            "examples": {
                "application/json": {"description": "An exemplary simulation result", "data": [ { "label": "albedo_ground", "unit": "1", "timeseries": [ { "timestamp":
                1526634000000, "value": 0.15174804687500001 }, { "timestamp": 1526637600000,
                "value": 0.15174804687500001 } ] }, { "label": "temperature_2m_ag", "unit": "K",
                "timeseries": [ { "timestamp": 1526634000000, "value": 286.0401916503906 }, {
                "timestamp": 1526637600000, "value": 287.0859680175781 } ] } ]}
            }
        }
    },
    "tags": [
        {
            "name": "Model Instances",
            "description": "A model instance is the executable version of a model with all parameters set, thus describing the behaviour of a specific system for all possible boundary conditions. The parameters of a model instance cannot be changed in order to ensure that identical service interactions always lead to the same result. Consequently, it is possible that different model instances describe the same specific system, which can be a result of different parameter sets or the use of different models."
        },
        {
            "name": "Experiments",
            "description": "An experiment denotes the execution of a model instance for given boundary conditions and simulation settings; in other words, a specific simulation."
        },
        {
            "name": "Unsuccessful Operations",
            "description": "Paths/operations using this tag only exist for demonstrating the API's responses to malformed requests."
        }
    ]
}
