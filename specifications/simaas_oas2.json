{
    "swagger": "2.0",
    "info": {
        "title": "SIMaaS Using Queue, Workers and fmpy",
        "version": "0.1.0"
    },
    "paths": {
        "/model_instances/{uuid}/_simulate": {
            "post": {
                "tags": ["Model Instances"],
                "summary": "Trigger the simulation of a model instance by defining an experiment, i.e. boundary conditions and simulation parameters",
                "consumes": [ "application/json" ],
                "parameters": [
                    {
                        "$ref": "#/parameters/setup_experiment"
                    }
                ],
                "responses": {
                    "202": {
                        "description": "An acknowledgement that the simulation was successfully triggered",
                        "headers": {
                            "Location": {
                                "description": "Referral to a resource that indicates the status of the long-running simulation; this resource needs to be polled ([RFC7231, section 7.1.2](https://tools.ietf.org/html/rfc7231#section-7.1.2))",
                                "type": "string"
                            }
                        }
                    }
                }
            },
            "parameters": [
                {
                    "name": "uuid",
                    "in": "path",
                    "description": "The UUID of the model instance to be simulated",
                    "required": true,
                    "type": "string",
                    "enum": ["c02f1f12-966d-4eab-9f21-dcf265ceac71"]
                }
            ]
        },
        "/experiments/{uuid}/status": {
            "get": {
                "tags": ["Experiments"],
                "summary": "A resource indicating the status of an experiment",
                "produces": [ "application/json" ],
                "responses": {
                    "200": {
                        "description": "The current status of the experiment",
                        "schema": {
                            "type": "object",
                            "required": [
                                "status"
                            ],
                            "properties": {
                                "status": {
                                    "type": "string",
                                    "enum": [ "NEW", "IN_PROGRESS", "DONE" ],
                                    "description": "The status of the background job, for example 'IN_PROGRESS'"
                                },
                                "link_to_result": {
                                    "type": "string",
                                    "description": "The link to the initially requested resource (the simulation result) that is now available. This property only exists if the status has reached 'DONE' and the result is indeed available."
                                }
                            }
                        },
                        "examples": {
                            "application/json": { "status": "DONE", "link_to_result": "https://host.tld/experiments/uuid/result"}
                        }
                    }
                }
            },
            "parameters": [
                { "$ref": "#/parameters/uuid_experiment" }
            ]
        },
        "/experiments/{uuid}/result": {
            "get": {
                "tags": ["Experiments"],
                "summary": "The results of performing the experiment by numerically solving a model instance, i.e. the simulation results",
                "produces": [ "application/json" ],
                "responses": {
                    "200": {
                        "$ref": "#/responses/simulation_result"
                    }
                }
            },
            "parameters": [
                { "$ref": "#/parameters/uuid_experiment" }
            ]
        }
    },
    "definitions": {
        "simulation_parameters": {
            "type": "object",
            "required": [
                "start_time",
                "stop_time"
            ],
            "properties": {
                "start_time": {
                    "description": "The beginning of the desired time frame for the simulation in [milliseconds since the UNIX epoch](https://en.wikipedia.org/wiki/Unix_time)",
                    "type": "integer",
                    "format": "int64",
                    "example": "1526637990000"
                },
                "stop_time": {
                    "description": "The end of the desired time frame for the simulation in [milliseconds since the UNIX epoch](https://en.wikipedia.org/wiki/Unix_time)",
                    "type": "integer",
                    "format": "int64",
                    "example": "1526551590000"
                },
                "output_interval": {
                    "description": "The desired output interval in seconds (does _not_ affect step size of the integration algorithm)",
                    "type": "number",
                    "example": "900"
                }
            }
        },
        "input_timeseries": {
            "type": "array",
            "items": {
                "$ref": "https://raw.githubusercontent.com/UdSAES/designetz_schemata/master/schemata/timeseries/schema_v1.2.0-oas2.json#/Timeseries"
            }
        }
    },
    "parameters": {
        "setup_experiment": {
            "name": "setup_experiment",
            "in": "body",
            "description": "The boundary conditions and simulation parameters that define an experiment",
            "required": true,
            "schema": {
                "type": "object",
                "required": [
                    "simulation_parameters"
                ],
                "properties": {
                    "simulation_parameters": {
                        "$ref": "#/definitions/simulation_parameters"
                    },
                    "input_timeseries": {
                        "$ref": "#/definitions/input_timeseries"
                    }
                },
                "example": {"simulation_parameters":{"start_time":"1526558400000","stop_time":"1526569200000","output_interval":"900"},"input_timeseries":[{"label":"SaaSu","unit":"W/m2","timeseries":[{"timestamp":1526558400000,"value":555.125},{"timestamp":1526559300000,"value":551.1875},{"timestamp":1526560200000,"value":568.28125},{"timestamp":1526561100000,"value":628.59375},{"timestamp":1526562000000,"value":631.875},{"timestamp":1526562900000,"value":607.7968750000724},{"timestamp":1526563800000,"value":593.4218750190755},{"timestamp":1526564700000,"value":559.8906250641351},{"timestamp":1526565600000,"value":515.2031250833663},{"timestamp":1526566500000,"value":458.42187504998253},{"timestamp":1526567400000,"value":401.109375043708},{"timestamp":1526568300000,"value":360.6250000271315},{"timestamp":1526569200000,"value":338.6562500432486}]},{"label":"SaaSu1","unit":"W/m2","timeseries":[{"timestamp":1526558400000,"value":238.53135991096497},{"timestamp":1526559300000,"value":238.43617391586304},{"timestamp":1526560200000,"value":220.99572658538818},{"timestamp":1526561100000,"value":171.54822373390198},{"timestamp":1526562000000,"value":158.77959752082825},{"timestamp":1526562900000,"value":161.28478050231934},{"timestamp":1526563800000,"value":157.22860145568848},{"timestamp":1526564700000,"value":164.33479499816895},{"timestamp":1526565600000,"value":176.16250228881836},{"timestamp":1526566500000,"value":193.0199851989746},{"timestamp":1526567400000,"value":207.74025344848633},{"timestamp":1526568300000,"value":210.68580627441406},{"timestamp":1526569200000,"value":201.1289520263672}]}]}
            }
        },
        "uuid_experiment": {
            "name": "uuid",
            "in": "path",
            "description": "A unique identifier for a specific experiment",
            "required": true,
            "type": "string"
        }
    },
    "responses": {
        "simulation_result": {
            "description": "The simulation result",
            "schema": {
                "type": "object",
                "required": [
                    "description",
                    "result"
                ],
                "properties": {
                    "description": {
                        "type": "string"
                    },
                    "result": {
                        "type": "array",
                        "items": {
                            "$ref": "https://raw.githubusercontent.com/UdSAES/designetz_schemata/master/schemata/timeseries/schema_v1.2.0-oas2.json#/Timeseries"
                        }
                    }
                }
            },
            "examples": {
                "application/json": {"description": "An exemplary simulation result", "data": [ { "label": "albedo_ground", "unit": "1", "timeseries": [ { "timestamp":
                1526634000000, "value": 0.15174804687500001 }, { "timestamp": 1526637600000,
                "value": 0.15174804687500001 } ] }, { "label": "temperature_2m_ag", "unit": "K",
                "timeseries": [ { "timestamp": 1526634000000, "value": 286.0401916503906 }, {
                "timestamp": 1526637600000, "value": 287.0859680175781 } ] } ]}
            }
        }
    },
    "tags": [
        {
            "name": "Model Instances"
        },
        {
            "name": "Experiments"
        }
    ]
}
